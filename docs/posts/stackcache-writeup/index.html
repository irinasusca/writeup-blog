<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Pico Stack Cache Writeup | Irina&#39;s CTF Writeups</title>
<meta name="keywords" content="picoCTF, pwn, buffer-overflow">
<meta name="description" content="Challenge overview
Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse this program to identify how you can get to the flag.

At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.
Analyzing the binary, we come across some interesting funtions, UnderConstruction and win.

After a quick checksec, we find vuln has both NX and a stack canary enabled.
So we can probably find a way to leak the stack canary using the UnderConstruction function.">
<meta name="author" content="">
<link rel="canonical" href="https://irinasusca.github.io/writeup-blog/posts/stackcache-writeup/">
<link crossorigin="anonymous" href="/writeup-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://irinasusca.github.io/writeup-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://irinasusca.github.io/writeup-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://irinasusca.github.io/writeup-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://irinasusca.github.io/writeup-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://irinasusca.github.io/writeup-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://irinasusca.github.io/writeup-blog/posts/stackcache-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://irinasusca.github.io/writeup-blog/posts/stackcache-writeup/">
  <meta property="og:site_name" content="Irina&#39;s CTF Writeups">
  <meta property="og:title" content="Pico Stack Cache Writeup">
  <meta property="og:description" content="Challenge overview Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse this program to identify how you can get to the flag.
At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.
Analyzing the binary, we come across some interesting funtions, UnderConstruction and win.
After a quick checksec, we find vuln has both NX and a stack canary enabled. So we can probably find a way to leak the stack canary using the UnderConstruction function.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-19T21:09:36+02:00">
    <meta property="article:modified_time" content="2025-11-19T21:09:36+02:00">
    <meta property="article:tag" content="PicoCTF">
    <meta property="article:tag" content="Pwn">
    <meta property="article:tag" content="Buffer-Overflow">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pico Stack Cache Writeup">
<meta name="twitter:description" content="Challenge overview
Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse this program to identify how you can get to the flag.

At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.
Analyzing the binary, we come across some interesting funtions, UnderConstruction and win.

After a quick checksec, we find vuln has both NX and a stack canary enabled.
So we can probably find a way to leak the stack canary using the UnderConstruction function.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://irinasusca.github.io/writeup-blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Pico Stack Cache Writeup",
      "item": "https://irinasusca.github.io/writeup-blog/posts/stackcache-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pico Stack Cache Writeup",
  "name": "Pico Stack Cache Writeup",
  "description": "Challenge overview Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse this program to identify how you can get to the flag.\nAt first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.\nAnalyzing the binary, we come across some interesting funtions, UnderConstruction and win.\nAfter a quick checksec, we find vuln has both NX and a stack canary enabled. So we can probably find a way to leak the stack canary using the UnderConstruction function.\n",
  "keywords": [
    "picoCTF", "pwn", "buffer-overflow"
  ],
  "articleBody": "Challenge overview Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse this program to identify how you can get to the flag.\nAt first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.\nAnalyzing the binary, we come across some interesting funtions, UnderConstruction and win.\nAfter a quick checksec, we find vuln has both NX and a stack canary enabled. So we can probably find a way to leak the stack canary using the UnderConstruction function.\nIdentifying the vulnerabilities We can easily buffer overflow (the offset I used was 14 of \\x90 padding and then I set the new eip as 0x8049E10, the beginning of UnderConstruction) into UnderConstruction, and we get a bunch of leaks:\nIt doesn’t seem like the stack canary is very effective. If we overwrite eip with the win function, it does indeed enter win, but no flag seems to be getting printed. Let’s analyze it further:\nAha! So if we look closely, what this does is it saves the flag in the stack, and if the flag array is null, it executes a _printf(%s %s);.\nIn my case, I have a flag.txt file created locally, so it doesn’t really output anything at all. What it does do though, is save the flag in the stack (also hinted by the challenge name, stack cache).\nWe can see the content of flag.txt being pushed on the stack.\nThe next logical step is making it so that the function called after win is UnderConstruction. We can do this without much hassle since we are working on a 32-bit executable, so no need to work with registers.\nThe stack alignment for 32-bit is function, parameters, return address and since these functions don’t need any params we can easily chain a bunch of functions.\npayload = b'\\x90'*14 payload += p32(0x8049D90) #win payload += p32(0x8049E10) #under constr devine ret addr la win payload += p32(0x8049E10) #a bunch of undr constr to leak the flag payload += p32(0x8049E10) #to get a bunch of %p 's payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049E10) payload += p32(0x8049EB0) #main Since I wanted to make sure that we would get all of the flag, not just a part of it, since pico flags are usually pretty long, I chained a lot of UnderConstruction functions together.\nAnd lo and behold! Dumping this into CyberChef, we can see the content of the flag is being shown on the stack, separated into 4 byte chunks with reversed bit order.\nAll that’s left to do is connect remotely and see if we can extract the flag.\nAnd that’s it! The rest of the code can be found on my GitHub here.\n",
  "wordCount" : "466",
  "inLanguage": "en",
  "datePublished": "2025-11-19T21:09:36+02:00",
  "dateModified": "2025-11-19T21:09:36+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://irinasusca.github.io/writeup-blog/posts/stackcache-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Irina's CTF Writeups",
    "logo": {
      "@type": "ImageObject",
      "url": "https://irinasusca.github.io/writeup-blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://irinasusca.github.io/writeup-blog/" accesskey="h" title="Irina&#39;s CTF Writeups (Alt + H)">Irina&#39;s CTF Writeups</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Pico Stack Cache Writeup
    </h1>
    <div class="post-meta"><span title='2025-11-19 21:09:36 +0200 EET'>November 19, 2025</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#challenge-overview" aria-label="Challenge overview">Challenge overview</a></li>
                <li>
                    <a href="#identifying-the-vulnerabilities" aria-label="Identifying the vulnerabilities">Identifying the vulnerabilities</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="challenge-overview">Challenge overview<a hidden class="anchor" aria-hidden="true" href="#challenge-overview">#</a></h2>
<p>Undefined behaviours are fun. It looks like Dr. Oswal allowed buffer overflows again. Analyse <strong><a href="https://play.picoctf.org/practice/challenge/306">this program</a></strong> to identify how you can get to the flag.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic1.png#center"></p>
<p>At first glance, the <strong>vuln</strong> looks like a 32-bit executable with a buffer overflow vulnerability.</p>
<p>Analyzing the binary, we come across some interesting funtions, <code>UnderConstruction</code> and <code>win</code>.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic2.png#center"></p>
<p>After a quick <code>checksec</code>, we find vuln has both NX and a stack canary enabled.
So we can probably find a way to leak the stack canary using the <code>UnderConstruction</code> function.</p>
<hr>
<h2 id="identifying-the-vulnerabilities">Identifying the vulnerabilities<a hidden class="anchor" aria-hidden="true" href="#identifying-the-vulnerabilities">#</a></h2>
<p>We can easily buffer overflow (the offset I used was 14 of <code>\x90</code> padding and then I set the new <code>eip</code> as <code>0x8049E10</code>, the beginning of <code>UnderConstruction</code>) into <code>UnderConstruction</code>, and we get a bunch of leaks:</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic3.png#center"></p>
<p>It doesn&rsquo;t seem like the stack canary is very effective.
If we overwrite <code>eip</code> with the <code>win</code> function, it does indeed enter <code>win</code>, but no flag seems to be getting printed. Let&rsquo;s analyze it further:</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic4.png#center"></p>
<p>Aha! So if we look closely, what this does is it saves the flag in the stack, and if the flag array is null, it executes a <code>_printf(%s %s);</code>.</p>
<p>In my case, I have a <code>flag.txt</code> file created locally, so it doesn&rsquo;t really output anything at all. What it <em>does</em> do though, is save the flag in the stack (also hinted by the challenge name, <em>stack cache</em>).</p>
<p>We can see the content of <code>flag.txt</code> being pushed on the stack.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic5.png#center"></p>
<hr>
<p>The next logical step is making it so that the function called after <code>win</code> is <code>UnderConstruction</code>. We can do this without much hassle since we are working on a 32-bit executable, so no need to work with registers.</p>
<p>The stack alignment for 32-bit is function, parameters, return address and since these functions don&rsquo;t need any params we can easily chain a bunch of functions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x90</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049D90</span>) <span style="color:#75715e">#win</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>) <span style="color:#75715e">#under constr devine ret addr la win</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>) <span style="color:#75715e">#a bunch of undr constr to leak the flag</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>) <span style="color:#75715e">#to get a bunch of %p &#39;s </span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049E10</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> p32(<span style="color:#ae81ff">0x8049EB0</span>) <span style="color:#75715e">#main</span>
</span></span></code></pre></div><p>Since I wanted to make sure that we would get all of the flag, not just a part of it, since pico flags are usually pretty long, I chained a lot of <code>UnderConstruction</code> functions together.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic6.png#center"></p>
<p>And lo and behold! Dumping this into CyberChef, we can see the content of the flag is being shown on the stack, separated into 4 byte chunks with reversed bit order.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic7.png#center"></p>
<p>All that&rsquo;s left to do is connect remotely and see if we can extract the flag.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/stackcache-writeup/pic8.png#center"></p>
<p>And that’s it! The rest of the code can be found on my GitHub
<strong><a href="https://github.com/irinasusca/ctf-writeups/blob/main/pico/stackcache.py">here</a></strong>.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/picoctf/">PicoCTF</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/pwn/">Pwn</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/buffer-overflow/">Buffer-Overflow</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://irinasusca.github.io/writeup-blog/">Irina&#39;s CTF Writeups</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
