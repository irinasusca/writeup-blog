<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Pico Ropfu Writeup | Irina&#39;s CTF Writeups</title>
<meta name="keywords" content="picoCTF, pwn, buffer-overflow, rop">
<meta name="description" content="Challenge overview
What&rsquo;s ROP? Can you exploit the following program to get the flag?

At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.

Identifying the vulnerabilities
Analyzing the binary, it doesn&rsquo;t look like anything special, just an ordinary buffer overflow.
We don&rsquo;t seem to have a /bin/sh in memory so this probably means we have to execute a ret2reg.

That means we need to make our own bin/sh and point to it, and since the vuln returns the gets, that means eax will hold the gets return value. And the return value of gets is a pointer to the input value!">
<meta name="author" content="">
<link rel="canonical" href="https://irinasusca.github.io/writeup-blog/posts/ropfu-writeup/">
<link crossorigin="anonymous" href="/writeup-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://irinasusca.github.io/writeup-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://irinasusca.github.io/writeup-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://irinasusca.github.io/writeup-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://irinasusca.github.io/writeup-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://irinasusca.github.io/writeup-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://irinasusca.github.io/writeup-blog/posts/ropfu-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://irinasusca.github.io/writeup-blog/posts/ropfu-writeup/">
  <meta property="og:site_name" content="Irina&#39;s CTF Writeups">
  <meta property="og:title" content="Pico Ropfu Writeup">
  <meta property="og:description" content="Challenge overview What’s ROP? Can you exploit the following program to get the flag?
At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.
Identifying the vulnerabilities Analyzing the binary, it doesn’t look like anything special, just an ordinary buffer overflow.
We don’t seem to have a /bin/sh in memory so this probably means we have to execute a ret2reg.
That means we need to make our own bin/sh and point to it, and since the vuln returns the gets, that means eax will hold the gets return value. And the return value of gets is a pointer to the input value!">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-24T21:09:36+02:00">
    <meta property="article:modified_time" content="2025-11-24T21:09:36+02:00">
    <meta property="article:tag" content="PicoCTF">
    <meta property="article:tag" content="Pwn">
    <meta property="article:tag" content="Buffer-Overflow">
    <meta property="article:tag" content="Rop">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pico Ropfu Writeup">
<meta name="twitter:description" content="Challenge overview
What&rsquo;s ROP? Can you exploit the following program to get the flag?

At first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.

Identifying the vulnerabilities
Analyzing the binary, it doesn&rsquo;t look like anything special, just an ordinary buffer overflow.
We don&rsquo;t seem to have a /bin/sh in memory so this probably means we have to execute a ret2reg.

That means we need to make our own bin/sh and point to it, and since the vuln returns the gets, that means eax will hold the gets return value. And the return value of gets is a pointer to the input value!">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://irinasusca.github.io/writeup-blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Pico Ropfu Writeup",
      "item": "https://irinasusca.github.io/writeup-blog/posts/ropfu-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pico Ropfu Writeup",
  "name": "Pico Ropfu Writeup",
  "description": "Challenge overview What\u0026rsquo;s ROP? Can you exploit the following program to get the flag?\nAt first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.\nIdentifying the vulnerabilities Analyzing the binary, it doesn\u0026rsquo;t look like anything special, just an ordinary buffer overflow.\nWe don\u0026rsquo;t seem to have a /bin/sh in memory so this probably means we have to execute a ret2reg.\nThat means we need to make our own bin/sh and point to it, and since the vuln returns the gets, that means eax will hold the gets return value. And the return value of gets is a pointer to the input value!\n",
  "keywords": [
    "picoCTF", "pwn", "buffer-overflow", "rop"
  ],
  "articleBody": "Challenge overview What’s ROP? Can you exploit the following program to get the flag?\nAt first glance, the vuln looks like a 32-bit executable with a buffer overflow vulnerability.\nIdentifying the vulnerabilities Analyzing the binary, it doesn’t look like anything special, just an ordinary buffer overflow.\nWe don’t seem to have a /bin/sh in memory so this probably means we have to execute a ret2reg.\nThat means we need to make our own bin/sh and point to it, and since the vuln returns the gets, that means eax will hold the gets return value. And the return value of gets is a pointer to the input value!\nThis is because eax/rax usually holds the current function’s return value.\nWould you look at that, no NX! So we can execute the code right on the stack! Since we have a large enough overflow (28 bytes), we don’t need to worry getting a shell.\nThat means we can just get a jmp eax gadget, and write our shellcraft.sh() at the start the input buffer.\nThe Exploit Well, looks like we need to write the shellcode ourselves, shellcraft.sh() was too large after all…\nI tried a bunch of shellcode that kept getting me segmentation faults, that I won’t include, and I tried fitting it all in our buffer before the jmp eax gadget, and I managed to get all the registers required right (for execve, ebx needs to be a pointer to /bin/sh, and ecx and edx need to be 0)\nAfter I set the address after eip, eip+4, to be a null-terminated /bin/sh, I noticed esp would become that value.\nSo, I tried doing\nmov ebx, esp xor ecx, ecx xor edx, edx mov al, 0x0b int 0x80 And my mistake was most likely that I messed with the stack frame, since execve kept returning error 0xffffff74 = -140 = ERFAULT.\nBut then I thought, if after the jmp eax the value at eip+4 goes into esp, why don’t we write the shellcode in eip+4, then just jmp esp to said shellcode?\nThat way, we can just use shellcraft.sh(), since we have unlimited space.\nSince jmp esp is just 2 bytes, we pad with 26 more nops to its left.\npayload = b'\\x90'*26 payload += asm('jmp esp') payload += jmp_eax #this will become esp after we execute jmp eax. newshell = asm(shellcraft.sh()) payload += newshell And it works!\nThe rest of the code can be found on my GitHub here.\n",
  "wordCount" : "408",
  "inLanguage": "en",
  "datePublished": "2025-11-24T21:09:36+02:00",
  "dateModified": "2025-11-24T21:09:36+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://irinasusca.github.io/writeup-blog/posts/ropfu-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Irina's CTF Writeups",
    "logo": {
      "@type": "ImageObject",
      "url": "https://irinasusca.github.io/writeup-blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://irinasusca.github.io/writeup-blog/" accesskey="h" title="Irina&#39;s CTF Writeups (Alt + H)">Irina&#39;s CTF Writeups</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Pico Ropfu Writeup
    </h1>
    <div class="post-meta"><span title='2025-11-24 21:09:36 +0200 EET'>November 24, 2025</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#challenge-overview" aria-label="Challenge overview">Challenge overview</a></li>
                <li>
                    <a href="#identifying-the-vulnerabilities" aria-label="Identifying the vulnerabilities">Identifying the vulnerabilities</a></li>
                <li>
                    <a href="#the-exploit" aria-label="The Exploit">The Exploit</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="challenge-overview">Challenge overview<a hidden class="anchor" aria-hidden="true" href="#challenge-overview">#</a></h2>
<p>What&rsquo;s ROP? Can you exploit the following <strong><a href="https://play.picoctf.org/practice/challenge/292">program</a></strong> to get the flag?</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic1.png#center"></p>
<p>At first glance, the <strong>vuln</strong> looks like a 32-bit executable with a buffer overflow vulnerability.</p>
<hr>
<h2 id="identifying-the-vulnerabilities">Identifying the vulnerabilities<a hidden class="anchor" aria-hidden="true" href="#identifying-the-vulnerabilities">#</a></h2>
<p>Analyzing the binary, it doesn&rsquo;t look like anything special, just an ordinary buffer overflow.</p>
<p>We don&rsquo;t seem to have a <code>/bin/sh</code> in memory so this probably means we have to execute a ret2reg.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic3.png#center"></p>
<p>That means we need to make our own <code>bin/sh</code> and point to it, and since the <code>vuln</code> <em>returns</em> the <code>gets</code>, that means <code>eax</code> will hold the <code>gets</code> return value. And the return value of <code>gets</code> is a pointer to the input value!</p>
<p>This is because <code>eax/rax</code> usually holds the current function&rsquo;s return value.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic4.png#center"></p>
<p>Would you look at that, no NX! So we can execute the code right on the stack! Since we have a large enough overflow (28 bytes), we don&rsquo;t need to worry getting a shell.</p>
<p>That means we can just get a <code>jmp eax</code> gadget, and write our <code>shellcraft.sh()</code> at the start the input buffer.</p>
<hr>
<h2 id="the-exploit">The Exploit<a hidden class="anchor" aria-hidden="true" href="#the-exploit">#</a></h2>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic5.png#center"></p>
<p>Well, looks like we need to write the shellcode ourselves, <code>shellcraft.sh()</code> was too large after all&hellip;</p>
<p>I tried a bunch of shellcode that kept getting me segmentation faults, that I won&rsquo;t include, and I tried fitting it all in our buffer before the <code>jmp eax</code> gadget, and I managed to get all the registers required right (for <code>execve</code>, <code>ebx</code> needs to be a pointer to <code>/bin/sh</code>, and <code>ecx</code> and <code>edx</code> need to be 0)</p>
<p>After I set the address after <code>eip</code>, <code>eip+4</code>, to be a null-terminated <code>/bin/sh</code>, I noticed <code>esp</code> would become that value.</p>
<p>So, I tried  doing</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    mov ebx, esp      
</span></span><span style="display:flex;"><span>    xor ecx, ecx
</span></span><span style="display:flex;"><span>    xor edx, edx
</span></span><span style="display:flex;"><span>    mov al, <span style="color:#ae81ff">0x0b</span>
</span></span><span style="display:flex;"><span>    int <span style="color:#ae81ff">0x80</span>
</span></span></code></pre></div><p>And my mistake was most likely that I messed with the stack frame, since <code>execve</code> kept returning error <code>0xffffff74 = -140 = ERFAULT</code>.</p>
<p>But then I thought, if after the <code>jmp eax</code> the value at <code>eip+4</code> goes into <code>esp</code>, why don&rsquo;t we <em>write the shellcode</em> in  <code>eip+4</code>, then just <code>jmp esp</code> to said shellcode?</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic7.png#center"></p>
<p>That way, we can just use <code>shellcraft.sh()</code>, since we have unlimited space.</p>
<p>Since <code>jmp esp</code> is just 2 bytes, we pad with 26 more nops to its left.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>payload <span style="color:#f92672">=</span>  <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x90</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> asm(<span style="color:#e6db74">&#39;jmp esp&#39;</span>)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> jmp_eax
</span></span><span style="display:flex;"><span><span style="color:#75715e">#this will become esp after we execute jmp eax.</span>
</span></span><span style="display:flex;"><span>newshell <span style="color:#f92672">=</span> asm(shellcraft<span style="color:#f92672">.</span>sh())
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">+=</span> newshell
</span></span></code></pre></div><hr>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/ropfu-writeup/pic9.png#center"></p>
<p>And it works!</p>
<p>The rest of the code can be found on my GitHub
<strong><a href="https://github.com/irinasusca/ctf-writeups/blob/main/pico/ropfu.py">here</a></strong>.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/picoctf/">PicoCTF</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/pwn/">Pwn</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/buffer-overflow/">Buffer-Overflow</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/rop/">Rop</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://irinasusca.github.io/writeup-blog/">Irina&#39;s CTF Writeups</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
