<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Serialization and Deserialization | Irina&#39;s CTF Writeups</title>
<meta name="keywords" content="Materials, web">
<meta name="description" content="Why
I decided to get more into this subject because of the challenge jargon. I was struggling with AIs and it was really getting on my nerves, because I felt I didn&rsquo;t really understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let&rsquo;s get into it.">
<meta name="author" content="">
<link rel="canonical" href="https://irinasusca.github.io/writeup-blog/posts/serialization/">
<link crossorigin="anonymous" href="/writeup-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://irinasusca.github.io/writeup-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://irinasusca.github.io/writeup-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://irinasusca.github.io/writeup-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://irinasusca.github.io/writeup-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://irinasusca.github.io/writeup-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://irinasusca.github.io/writeup-blog/posts/serialization/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://irinasusca.github.io/writeup-blog/posts/serialization/">
  <meta property="og:site_name" content="Irina&#39;s CTF Writeups">
  <meta property="og:title" content="Serialization and Deserialization">
  <meta property="og:description" content="Why I decided to get more into this subject because of the challenge jargon. I was struggling with AIs and it was really getting on my nerves, because I felt I didn’t really understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let’s get into it.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-08T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-08T00:00:00+00:00">
    <meta property="article:tag" content="Materials">
    <meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serialization and Deserialization">
<meta name="twitter:description" content="Why
I decided to get more into this subject because of the challenge jargon. I was struggling with AIs and it was really getting on my nerves, because I felt I didn&rsquo;t really understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let&rsquo;s get into it.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://irinasusca.github.io/writeup-blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Serialization and Deserialization",
      "item": "https://irinasusca.github.io/writeup-blog/posts/serialization/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Serialization and Deserialization",
  "name": "Serialization and Deserialization",
  "description": "Why I decided to get more into this subject because of the challenge jargon. I was struggling with AIs and it was really getting on my nerves, because I felt I didn\u0026rsquo;t really understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let\u0026rsquo;s get into it.\n",
  "keywords": [
    "Materials", "web"
  ],
  "articleBody": "Why I decided to get more into this subject because of the challenge jargon. I was struggling with AIs and it was really getting on my nerves, because I felt I didn’t really understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let’s get into it.\nWhat are they? First of all, let’s clarify serialization and deserialization. I’m going to be getting most of my information from this Portwsigger Lab.\nSerialization is the process of converting complex data structures, such as objects and their fields, into a “flatter” format that can be sent and received as a sequential stream of bytes. Serializing data makes it much simpler to:\nWrite complex data to inter-process memory, a file, or a database Send complex data, for example, over a network, between different components of an application, or in an API call So essentially, just packing something like an object into something tighter, so that it doesn’t take up that much space.\nDeserialization is the process of restoring this byte stream to a fully functional replica of the original object, in the exact state as when it was serialized. The website’s logic can then interact with this deserialized object, just like it would with any other object.\nThis is the server interpreting that data in a way to make it usable again.\nEvery language handles this differently. The main ones are PHP, Ruby, Java and python.\nVulnerabilities Insecure deserialization comes when the server deserializes user-controlled data. This way, we could send harmful data that will affect the application. We could even send a serialized object of an entirely different class than expected, and the website would just deserialize it like normal.\nThis is why this is sometimes called an object injection vulnerability.\nTo avoid this, ideally, user input should just never be deserialized. When is trusting the user ever a good idea?\nSome people don’t do this though, and add their on deserialization-protection-sanitization-logic which can always be bypassed, you simply can’t account for everything.\nExploits Now, the interesting part; How can we take advantage of this educationally? And how can we identify them?\nPHP:\nuses a human-readable format, with letters representing the data type, and numbers representing the length of each entry. data: $user-\u003ename = \"carlos\"; $user-\u003eisLoggedIn = true; serialized: O:4:\"User\":2:{s:4:\"name\":s:6:\"carlos\";s:10:\"isLoggedIn\":b:1;} The native PHP methods for this are serialize() and deserialize(). Just investigate around the deserialize().\nHere, keep in mind these (older) 7.x PHP vulnerabilities:\n5 == “5” or 5 == “5 lalala” both are evaluated as true 0 == “string” is always true So just replacing the password with 0 would grant auth.\nJava:\nuses binary serialization, obviously harder to read always begin with the same bytes; ac ed in hex, ro0 in Base64 classes that implement java.io.Serializable can be serialized and deserialized. Look for any code using readObject(), used to read and deserialize.\nMagic Methods We also need to talk a little bit about magic methods. They’re a “special subset of methods that you do not have to explicitly invoke”. They happen a lot in OOP, and sometimes they have that __ prefix.\nThey’re added by developers to control what code should be executed when a scenario occurs. That sounds complicated, but take for example the PHP __construct(), or the python __init__, it’s something that happens when the object is instantiated. Developers can make their own such methods, for anything.\nWhy is this relevant whatsoever you may ask? It’s because some languages have magic methods that are invoked automatically during deserialization.\nPHP’s unserialize() looks for and invokes an object’s __wakeup() magic method.\n__wakeup() has a sibling __sleep() and they’re needed because some properties shouldn’t be serialized using the serialize() function. To let PHP know which properties should be ignored and which shouldn’t, we use:\n__sleep() for returning an array of all the properties that should be included in the serialized object, and a null for properties that shouldn’t; It’s called before serialization to let PHP know which properties should be included in the string representation __wakeup() for any initialization code that should be executed once the object has been re-created. Like internal object relationships, configuration stuff… Java’s ObjectInputStream.readObject() reads the data, and acts like a sort of constructor for re-initializing a serialized object. But Serializable classes can also declare their own readObject() method, that acts like that __wakeup() thing I mentioned. This stuff is important for more advanced exploits, though.\nInjecting Objects As I said before, injecting arbitrary objects is possible sometimes. In OOP, the methords available to an Object are determined by its class. So, if you manually change that class, we can influence the code executed around deserialization.\nIf you have access to the source code, you can study all the classes, and their magic methods and whether they have any malicious potential to be used.\nAka using a different class’ methods on our injected Object.\nGadget chains A “gadget” is a snippet of code that exists in the application that can help an attacker to achieve a particular goal.\nLike our ROP gadgets in pwn, I guess we have gadgets here too!\nWe have pre-built gadget chains, since manually finding them is a total pain, and we have a couple of tools for that, like ysoserial:\nInstall from here Choose a gadget chain, pass a command You need Java 8 because of course it’s not compatible with newer Javas; If you want to use Java 16 and above, you need a bunch of command line arguments:\njava -jar ysoserial-all.jar \\ --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \\ --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \\ --add-opens=java.base/java.net=ALL-UNNAMED \\ --add-opens=java.base/java.util=ALL-UNNAMED \\ [payload] '[command]' There’s a lot of trial and error that comes with this.\nFor PHP-based sites, they’re called PHP Generic Gadget Chains (PHPGGC).\nEven if there’s no tools for exploiting gadget chains, you could just look online for documented exploits (duh).\nPHAR deserialization This is the special case in PHP, where we can exploit deserialization without the obvious use of the unserialize() mentioned earlier.\nPHP has some special wrappers for different protocols when accessing file paths; For example, phar://, an interface to access PHP archive (.phar) files.\nThis is very interesting; PHAR manifest files contain serialized metadata, and if we perform any filesystem operation on it, this metadata gets deserialized. So if we can pass this stream into a filesystem method, there’s our vuln.\nSome dangerous filesystem methods are include(), fopen() (more protected) and file_exists() (usually not so protected).\nThis is when we can upload a PHAR, maybe tricking the server into thinking its a jpg or something. If we can force the website to load this jpg-phar with the phar:// stream, any harmful injected metadata will be deserialized! This doesn’t check whether the extension is jpg and whatnot, just loads it.\nThis way, both the __wakeup() and __destruct() magic methods can be invoked.\n",
  "wordCount" : "1147",
  "inLanguage": "en",
  "datePublished": "2026-01-08T00:00:00Z",
  "dateModified": "2026-01-08T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://irinasusca.github.io/writeup-blog/posts/serialization/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Irina's CTF Writeups",
    "logo": {
      "@type": "ImageObject",
      "url": "https://irinasusca.github.io/writeup-blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://irinasusca.github.io/writeup-blog/" accesskey="h" title="Irina&#39;s CTF Writeups (Alt + H)">Irina&#39;s CTF Writeups</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Serialization and Deserialization
    </h1>
    <div class="post-meta"><span title='2026-01-08 00:00:00 +0000 UTC'>January 8, 2026</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#why" aria-label="Why">Why</a></li>
                <li>
                    <a href="#what-are-they" aria-label="What are they?">What are they?</a></li>
                <li>
                    <a href="#vulnerabilities" aria-label="Vulnerabilities">Vulnerabilities</a></li>
                <li>
                    <a href="#exploits" aria-label="Exploits">Exploits</a></li>
                <li>
                    <a href="#magic-methods" aria-label="Magic Methods">Magic Methods</a></li>
                <li>
                    <a href="#injecting-objects" aria-label="Injecting Objects">Injecting Objects</a></li>
                <li>
                    <a href="#gadget-chains" aria-label="Gadget chains">Gadget chains</a></li>
                <li>
                    <a href="#phar-deserialization" aria-label="PHAR deserialization">PHAR deserialization</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="why">Why<a hidden class="anchor" aria-hidden="true" href="#why">#</a></h2>
<p>I decided to get more into this subject because of the challenge <strong><a href="irinasusca.github.io/writeup-blog/posts/jargon-writeup/">jargon</a></strong>. I was struggling with AIs and it was really getting on my nerves, because I felt I didn&rsquo;t <em>really</em> understand what was going on. So I decided to write a little article about this, to make myself fully grasp serialization, deserialization and the subset of vulnerabilities that may come with them. So, let&rsquo;s get into it.</p>
<hr>
<h2 id="what-are-they">What are they?<a hidden class="anchor" aria-hidden="true" href="#what-are-they">#</a></h2>
<p>First of all, let&rsquo;s clarify serialization and deserialization. I&rsquo;m going to be getting most of my information from this <a href="https://portswigger.net/web-security/deserialization">Portwsigger Lab</a>.</p>
<blockquote>
<p>Serialization is the process of converting complex data structures, such as objects and their fields, into a &ldquo;flatter&rdquo; format that can be sent and received as a sequential stream of bytes. Serializing data makes it much simpler to:</p>
<ul>
<li>Write complex data to inter-process memory, a file, or a database</li>
<li>Send complex data, for example, over a network, between different components of an application, or in an API call</li>
</ul></blockquote>
<p>So essentially, just packing something like an object into something tighter, so that it doesn&rsquo;t take up that much space.</p>
<blockquote>
<p>Deserialization is the process of restoring this byte stream to a fully functional replica of the original object, in the exact state as when it was serialized. The website&rsquo;s logic can then interact with this deserialized object, just like it would with any other object.</p></blockquote>
<p>This is the server interpreting that data in a way to make it usable again.</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/serialization/diagram.jpg#center"></p>
<p>Every language handles this differently. The main ones are <em>PHP</em>, <em>Ruby</em>, <em>Java</em> and <em>python</em>.</p>
<hr>
<h2 id="vulnerabilities">Vulnerabilities<a hidden class="anchor" aria-hidden="true" href="#vulnerabilities">#</a></h2>
<p>Insecure deserialization comes when the server deserializes user-controlled data. This way, we could send harmful data that will affect the application. We could even send a serialized object of an entirely different class than expected, and the website would just deserialize it like normal.</p>
<p>This is why this is sometimes called an <em>object injection</em> vulnerability.</p>
<p>To avoid this, ideally, user input should just <em>never</em> be deserialized. When is trusting the user ever a good idea?</p>
<p>Some people don&rsquo;t do this though, and add their on deserialization-protection-sanitization-logic which can always be bypassed, you simply can&rsquo;t account for everything.</p>
<hr>
<h2 id="exploits">Exploits<a hidden class="anchor" aria-hidden="true" href="#exploits">#</a></h2>
<p>Now, the interesting part; How can we take advantage of this educationally? And how can we identify them?</p>
<p><strong>PHP</strong>:</p>
<ul>
<li>uses a human-readable format, with letters representing the data type, and numbers representing the length of each entry.</li>
<li>data: <code>$user-&gt;name = &quot;carlos&quot;; $user-&gt;isLoggedIn = true;</code></li>
<li>serialized: <code>O:4:&quot;User&quot;:2:{s:4:&quot;name&quot;:s:6:&quot;carlos&quot;;s:10:&quot;isLoggedIn&quot;:b:1;}</code></li>
</ul>
<p>The native PHP methods for this are <code>serialize()</code> and <code>deserialize()</code>. Just investigate around the <code>deserialize()</code>.</p>
<p>Here, keep in mind these (older) <code>7.x</code> PHP vulnerabilities:</p>
<ul>
<li>5 == &ldquo;5&rdquo; or 5 == &ldquo;5 lalala&rdquo; both are evaluated as true</li>
<li>0 == &ldquo;string&rdquo; is always true</li>
</ul>
<p>So just replacing the password with <code>0</code> would grant auth.</p>
<p><strong>Java</strong>:</p>
<ul>
<li>uses binary serialization, obviously harder to read</li>
<li>always begin with the same bytes; <code>ac ed</code> in hex, <code>ro0</code> in Base64</li>
<li>classes that implement <code>java.io.Serializable</code> can be serialized and deserialized.</li>
</ul>
<p>Look for any code using <code>readObject()</code>, used to read and deserialize.</p>
<hr>
<h2 id="magic-methods">Magic Methods<a hidden class="anchor" aria-hidden="true" href="#magic-methods">#</a></h2>
<p>We also need to talk a little bit about <em>magic methods</em>. They&rsquo;re a &ldquo;special subset of methods that you do not have to explicitly invoke&rdquo;. They happen a lot in OOP, and sometimes they have that <code>__</code> prefix.</p>
<p>They&rsquo;re added by developers to control what code should be executed when a scenario occurs. That sounds complicated, but take for example the PHP <code>__construct()</code>, or the python <code>__init__</code>, it&rsquo;s something that happens when the object is instantiated. Developers can make their own such methods, for anything.</p>
<p>Why is this relevant whatsoever you may ask? It&rsquo;s because some languages have magic methods that are invoked automatically during deserialization.</p>
<p>PHP&rsquo;s <code>unserialize()</code> looks for and invokes an object&rsquo;s <code>__wakeup()</code> magic method.</p>
<p><code>__wakeup()</code> has a sibling <code>__sleep()</code> and they&rsquo;re needed because some properties shouldn&rsquo;t be serialized using the <code>serialize()</code> function. To let PHP know which properties should be ignored and which shouldn&rsquo;t, we use:</p>
<ul>
<li><code>__sleep()</code> for returning an array of all the properties that should be included in the serialized object, and a <em>null</em> for properties that shouldn&rsquo;t; It&rsquo;s called before serialization to let PHP know which properties should be included in the string representation</li>
<li><code>__wakeup()</code> for any initialization code that should be executed once the object has been re-created. Like internal object relationships, configuration stuff&hellip;</li>
</ul>
<p>Java&rsquo;s <code>ObjectInputStream.readObject()</code> reads the data, and acts like a sort of constructor for re-initializing a serialized object. But <code>Serializable</code> classes can also declare their own <code>readObject()</code> method, that acts like that <code>__wakeup()</code> thing I mentioned. This stuff is important for more advanced exploits, though.</p>
<hr>
<h2 id="injecting-objects">Injecting Objects<a hidden class="anchor" aria-hidden="true" href="#injecting-objects">#</a></h2>
<p>As I said before, injecting arbitrary objects is possible sometimes. In OOP, the methords available to an Object are determined by its class. So, if you manually change that class, we can influence the code executed around deserialization.</p>
<p>If you have access to the source code, you can study all the classes, and their magic methods and whether they have any malicious potential to be used.</p>
<p>Aka using a different class&rsquo; methods on our injected Object.</p>
<hr>
<h2 id="gadget-chains">Gadget chains<a hidden class="anchor" aria-hidden="true" href="#gadget-chains">#</a></h2>
<blockquote>
<p>A &ldquo;gadget&rdquo; is a snippet of code that exists in the application that can help an attacker to achieve a particular goal.</p></blockquote>
<p>Like our ROP gadgets in pwn, I guess we have gadgets here too!</p>
<p>We have pre-built gadget chains, since manually finding them is a total pain, and we have a couple of tools for that, like <code>ysoserial</code>:</p>
<ul>
<li>Install from <a href="https://github.com/frohoff/ysoserial">here</a></li>
<li>Choose a gadget chain, pass a command</li>
</ul>
<p>You need Java 8 because of course it&rsquo;s not compatible with newer Javas; If you want to use Java 16 and above, you need a bunch of command line arguments:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>java <span style="color:#f92672">-</span>jar ysoserial<span style="color:#f92672">-</span>all<span style="color:#f92672">.</span>jar \
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">--</span>add<span style="color:#f92672">-</span>opens<span style="color:#f92672">=</span>java<span style="color:#f92672">.</span>xml<span style="color:#f92672">/</span>com<span style="color:#f92672">.</span>sun<span style="color:#f92672">.</span>org<span style="color:#f92672">.</span>apache<span style="color:#f92672">.</span>xalan<span style="color:#f92672">.</span>internal<span style="color:#f92672">.</span>xsltc<span style="color:#f92672">.</span>trax<span style="color:#f92672">=</span>ALL<span style="color:#f92672">-</span>UNNAMED \
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">--</span>add<span style="color:#f92672">-</span>opens<span style="color:#f92672">=</span>java<span style="color:#f92672">.</span>xml<span style="color:#f92672">/</span>com<span style="color:#f92672">.</span>sun<span style="color:#f92672">.</span>org<span style="color:#f92672">.</span>apache<span style="color:#f92672">.</span>xalan<span style="color:#f92672">.</span>internal<span style="color:#f92672">.</span>xsltc<span style="color:#f92672">.</span>runtime<span style="color:#f92672">=</span>ALL<span style="color:#f92672">-</span>UNNAMED \
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">--</span>add<span style="color:#f92672">-</span>opens<span style="color:#f92672">=</span>java<span style="color:#f92672">.</span>base<span style="color:#f92672">/</span>java<span style="color:#f92672">.</span>net<span style="color:#f92672">=</span>ALL<span style="color:#f92672">-</span>UNNAMED \
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">--</span>add<span style="color:#f92672">-</span>opens<span style="color:#f92672">=</span>java<span style="color:#f92672">.</span>base<span style="color:#f92672">/</span>java<span style="color:#f92672">.</span>util<span style="color:#f92672">=</span>ALL<span style="color:#f92672">-</span>UNNAMED \
</span></span><span style="display:flex;"><span>   [payload] <span style="color:#e6db74">&#39;[command]&#39;</span>
</span></span></code></pre></div><p>There&rsquo;s a lot of trial and error that comes with this.</p>
<p>For PHP-based sites, they&rsquo;re called <em>PHP Generic Gadget Chains</em> (PHPGGC).</p>
<p>Even if there&rsquo;s no tools for exploiting gadget chains, you could just look online for documented exploits (duh).</p>
<hr>
<h2 id="phar-deserialization">PHAR deserialization<a hidden class="anchor" aria-hidden="true" href="#phar-deserialization">#</a></h2>
<p>This is the special case in PHP, where we can exploit deserialization without the obvious use of the <code>unserialize()</code> mentioned earlier.</p>
<p>PHP has some special wrappers for different protocols when accessing file paths; For example, <code>phar://</code>, an interface to access PHP archive (<code>.phar</code>) files.</p>
<p>This is very interesting; <code>PHAR</code> manifest files contain <em>serialized metadata</em>, and if we perform any filesystem operation on it, this metadata gets deserialized. So if we can pass this stream into a <em>filesystem method</em>, there&rsquo;s our vuln.</p>
<p>Some dangerous <em>filesystem methods</em> are <code>include()</code>, <code>fopen()</code> (more protected) and <code>file_exists()</code> (usually not so protected).</p>
<p>This is when we can upload a <code>PHAR</code>, maybe tricking the server into thinking its a <code>jpg</code> or something. If we can force the website to load this jpg-phar with the <code>phar://</code> stream, any harmful injected metadata will be deserialized! This doesn&rsquo;t check whether the extension is <code>jpg</code> and whatnot, just loads it.</p>
<p>This way, both the <code>__wakeup()</code> and <code>__destruct()</code> magic methods can be invoked.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/materials/">Materials</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/web/">Web</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://irinasusca.github.io/writeup-blog/">Irina&#39;s CTF Writeups</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
